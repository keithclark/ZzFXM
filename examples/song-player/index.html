<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ZzFXM Song Player - ZzFXM Music Player Examples</title>
  <style>body {font:100%/1.5 Arial}button,select{font:inherit}</style>
</head>
<body>
<h1>ZzFXM Song Player Demo</h1>
<p>Select a song and click play:</p>
<label>Song:
  <select id="song">
    <option value="sanxion">Sanxion</option>
    <option value="cuddly">Cuddly Demos (Main menu)</option>
    <option value="iamback">I am back</option>
  </select>
</label>

<button id="playBtn">Play</button>
<button id="stopBtn">Stop</button>

<script src="../../zzfx.js"></script>
<script src="../../zzfxm.min.js"></script>

<script type="module">

  let buffer;
  let node;

  const load = async name => {
    let module = await import(`../songs/${name}.js`);
    buffer = zzfxM(...module.default);
  }

  const change = async e => {
    await load(e.target.value);
    if (node) {
      await stop();
      await play();
    }
  }

  // Play the tune
  const play = async () => {
    if (!node) {
      // Resume the AudioContext (saves CPU usage when a song isn't playing)
      await zzfxX.resume();

      // play the song and loop it
      node = zzfxP(...buffer);
      node.loop = true;
    }
  }

  // Stop playing the tune
  const stop = async () => {
    if (node) {
      node.stop();
      node.disconnect(); // prevent memory leaks
      node = null;
    }
    // This reduces CPU usage when a song isn't playing
    await zzfxX.suspend();
  }

  const songSelectElem = document.getElementById('song');
  const songPlayElem = document.getElementById('playBtn');
  const songStopElem = document.getElementById('stopBtn');

  songPlayElem.addEventListener('click', play);
  songStopElem.addEventListener('click', stop);
  songSelectElem.addEventListener('change', change);

  stop();
  load(songSelectElem.value);
</script>
</body>
</html>